<!DOCTYPE html>
<html>
<head>
    <title>Список пользователей - Админка</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .admin-theme {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body class="admin-theme">
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-white">
            <i class="bi bi-people-fill me-2"></i>Управление пользователями
        </h1>
        <a href="/" class="btn btn-light">
            <i class="bi bi-arrow-left me-2"></i>На главную
        </a>
    </div>

    <div class="card admin-card">
        <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h4 class="mb-0">
                <i class="bi bi-list-ul me-2"></i>Список пользователей ({{ user_stats|length }})
            </h4>
        </div>
        <div class="card-body">
            {% if user_stats %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Аватар</th>
                            <th>Имя пользователя</th>
                            <th>Пароль (хэш)</th>
                            <th>Email</th>
                            <th>Промптов</th>
                            <th>Изображений</th>
                            <th>Дата регистрации</th>
                            <th>Действия</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for stat in user_stats %}
                            <tr>
                                <td>
                                    <img src="
                                            {% if stat.user.avatar %}{{ stat.user.avatar.url }}{% else %}/static/default_avatar.png{% endif %}"
                                         class="user-avatar" alt="Аватар">
                                </td>
                                <td>
                                    <strong>{{ stat.user.username }}</strong>
                                    {% if stat.user.is_superuser %}
                                        <span class="badge bg-danger ms-1">Админ</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted" title="{{ stat.user.password }}">
                                        {{ stat.user.password|truncatechars:20 }}
                                    </small>
                                </td>
                                <td>{{ stat.user.email|default:"Не указан" }}</td>
                                <td>
                                    <span class="badge bg-primary">{{ stat.prompt_count }}</span>
                                </td>
                                <td>
                                    <span class="badge bg-success">{{ stat.image_count }}</span>
                                </td>
                                <td>{{ stat.user.date_joined|date:"d.m.Y H:i" }}</td>
                                <td>
                                    <a href="{% url 'user_detail' stat.user.id %}"
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye me-1"></i>Подробнее
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-people display-1 text-muted"></i>
                    <h4 class="text-muted mt-3">Пользователи не найдены</h4>
                </div>
            {% endif %}
        </div>
    </div>
</div>
</body>
</html>